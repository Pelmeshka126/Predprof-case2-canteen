{% extends "base.html" %}
{% block title %}Кабинет ученика{% endblock %}
{% block content %}
<h1>Кабинет ученика</h1>
<div class="grid grid-2">
  <div class="card">
    <h3>Пищевые аллергии и предпочтения</h3>
    <form method="post" action="{{ url_for('routes.student_profile') }}">
      <label>Аллергии</label>
      <textarea name="allergies" rows="2" placeholder="например: орехи, молочные продукты">{{ student['allergies'] }}</textarea>
      <label>Пищевые предпочтения</label>
      <textarea name="preferences" rows="2" placeholder="например: без сахара, больше овощей">{{ student['preferences'] }}</textarea>
      <button type="submit">Сохранить профиль питания</button>
    </form>
  </div>

  <div class="card">
    <h3>Меню и отметка получения</h3>
    <table>
      <tr><th>Дата</th><th>Тип</th><th>Блюдо</th><th>Цена</th><th>Остаток</th><th>Действие</th></tr>
      {% for item in menu_items %}
      <tr>
        <td>{{ item['date'] }}</td>
        <td>{{ 'Завтрак' if item['meal_type']=='breakfast' else 'Обед' }}</td>
        <td>{{ item['title'] }}</td>
        <td>{{ item['price'] }}</td>
        <td>{{ item['available_qty'] }}</td>
        <td>
          <form class="inline-form" method="post" action="{{ url_for('routes.student_claim') }}">
            <input type="hidden" name="menu_item_id" value="{{ item['id'] }}">
            <button type="submit">Отметить получение</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </table>
  </div>

  <div class="card">
    <h3>Оплата</h3>
    <form method="post" action="{{ url_for('routes.student_pay') }}">
      <label>Тип оплаты</label>
      <select name="payment_type">
        <option value="one_time">Разовый платеж</option>
        <option value="subscription">Абонемент</option>
      </select>
      <label>Сумма</label>
      <input type="number" step="0.01" name="amount" value="200" required>
      <button type="submit">Оплатить</button>
    </form>
    <h3>История оплат</h3>
    <table>
      <tr><th>Дата</th><th>Тип</th><th>Сумма</th><th>Статус</th></tr>
      {% for p in payments %}
      <tr><td>{{ p['created_at'] }}</td><td>{{ p['payment_type'] }}</td><td>{{ p['amount'] }}</td><td>{{ p['status'] }}</td></tr>
      {% endfor %}
    </table>
  </div>
</div>

<div class="grid grid-2">
  <div class="card">
    <h3>Отзывы о блюдах</h3>
    <form method="post" action="{{ url_for('routes.student_feedback') }}">
      <label>Блюдо</label>
      <select name="menu_item_id">
        {% for item in menu_items %}<option value="{{ item['id'] }}">{{ item['title'] }}</option>{% endfor %}
      </select>
      <label>Оценка (1-5)</label>
      <input type="number" min="1" max="5" name="rating" value="5" required>
      <label>Комментарий</label>
      <textarea name="comment" rows="3" required></textarea>
      <button type="submit">Сохранить отзыв</button>
    </form>
    <table>
      <tr><th>Дата</th><th>Блюдо</th><th>Оценка</th><th>Комментарий</th></tr>
      {% for row in feedback_list %}
      <tr><td>{{ row['created_at'] }}</td><td>{{ row['title'] }}</td><td>{{ row['rating'] }}</td><td>{{ row['comment'] }}</td></tr>
      {% endfor %}
    </table>
  </div>

  <div class="card">
    <h3>Мои отметки питания</h3>
    <table>
      <tr><th>Дата</th><th>Тип</th><th>Блюдо</th></tr>
      {% for c in claims %}
      <tr><td>{{ c['claimed_at'] }}</td><td>{{ c['meal_type'] }}</td><td>{{ c['title'] }}</td></tr>
      {% endfor %}
    </table>
  </div>
</div>
{% endblock %}
