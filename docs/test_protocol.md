# Протокол тестирования

## 1. Окружение

- ОС: Ubuntu/WSL
- Python: 3.12+
- Запуск: `./scripts/run_local.sh`
- URL: `http://127.0.0.1:5000`

## 2. Интеграционные тесты

Команда:

```bash
python -m unittest discover -s tests -v
```

Ожидаемый результат: все тесты зеленые (текущее состояние: 32/32).

Покрываемые группы:
- RBAC и доступы;
- CSRF positive/negative;
- регистрация только ученика;
- управление ролями и блокировкой;
- корректность numeric-валидации;
- legacy policy;
- периодные отчеты и CSV;
- audit log;
- миграции и env-конфиг.

## 3. Ручные сценарии

1. Открыть `/register` и убедиться, что нет выбора роли.
2. Войти учеником и провести оплату.
3. Отметить питание дважды, убедиться в запрете повтора.
4. Войти поваром, создать заявку с дробями.
5. Войти администратором, одобрить заявку.
6. Проверить `/admin/dashboard` с разными периодами.
7. Скачать CSV и сверить ключевые суммы с dashboard.
8. Открыть `/admin/users`, сменить роль и блокировать/разблокировать.
9. Проверить блок «Последние действия администратора».

## 4. Визуальная проверка

Снять скриншоты:

```bash
LD_LIBRARY_PATH="$(pwd)/.localdeps/usr/lib/x86_64-linux-gnu:${LD_LIBRARY_PATH}" python3 scripts/visual_debug_loop.py
```

Артефакты: `output/playwright_v3/`.

Проверяем брейкпоинты: `360`, `390`, `768`, `1024`, `1280`.

Критерии:
- отсутствуют наложения элементов;
- таблицы не ломают карточки;
- кнопки не перекрывают текст;
- доступен корректный скролл в широких таблицах.
