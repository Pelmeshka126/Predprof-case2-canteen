# Протокол ручного тестирования

## Окружение

- ОС: Ubuntu/WSL
- Python: 3.x
- Запуск: `python3 app.py`
- URL: `http://127.0.0.1:5000`

## Сценарии

1. Регистрация ученика:
- Шаги: `/register` -> заполнить форму -> отправить.
- Ожидаемо: успешная регистрация, вход возможен, роль пользователя `student`.

2. Попытка подменить роль при регистрации:
- Шаги: отправить POST с `role=admin`.
- Ожидаемо: пользователь создан как `student`.

3. CSRF без токена:
- Шаги: отправить любой POST без `csrf_token`.
- Ожидаемо: `403 Forbidden`.

4. CSRF с неверным токеном:
- Шаги: отправить POST с произвольным токеном.
- Ожидаемо: `403 Forbidden`.

5. RBAC запрет чужого маршрута:
- Шаги: войти как `student`, открыть `/admin/dashboard`.
- Ожидаемо: `403 Forbidden`.

6. Блокировка пользователя:
- Шаги: админ блокирует пользователя в `/admin/users`, пользователь пытается войти.
- Ожидаемо: вход запрещен, сообщение о блокировке.

7. Смена роли админом:
- Шаги: `/admin/users` -> сменить роль пользователя.
- Ожидаемо: роль обновлена в таблице и в БД.

8. Заявка с невалидным числом (экспонента):
- Шаги: повар отправляет `qty=1e9`.
- Ожидаемо: ошибка «экспоненциальная запись недопустима».

9. Заявка с выходом за лимит:
- Шаги: повар отправляет `unit_price=1000000000`.
- Ожидаемо: ошибка «превышен допустимый максимум».

10. Валидные дроби:
- Шаги: повар отправляет `qty=12.345`, `unit_price=71.50`.
- Ожидаемо: запись сохраняется, в таблице вывод без `e+...`.

11. Исключение «повторная отметка питания»:
- Шаги: ученик отмечает то же блюдо второй раз.
- Ожидаемо: повтор запрещен, корректное сообщение.

12. Исключение «нехватка продукта»:
- Шаги: при нулевом остатке выполнить выдачу.
- Ожидаемо: операция отклонена с сообщением.

13. Админ-отчет и CSV:
- Шаги: одобрить заявку, открыть dashboard, скачать CSV.
- Ожидаемо: корректные суммы затрат/баланса, CSV содержит timestamp.

14. UI-устойчивость таблиц:
- Шаги: открыть большие таблицы на desktop/mobile ширине.
- Ожидаемо: карточки не ломаются, доступен горизонтальный скролл.

## Автотесты

```bash
python -m unittest discover -s tests -v
```

Ожидаемо: все тесты проходят (15/15).
