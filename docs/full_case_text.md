# Полный текст кейса №2 «Управление столовой»

## 1. Титульный блок

- Олимпиада: Московская предпрофессиональная олимпиада школьников 2025/2026
- Профиль: Информационные технологии
- Командный кейс: №2 «Управление столовой»
- Команда: `<вставить название>`
- Участники: `<ФИО>`
- Школа: `<вставить>`
- Руководитель: `<вставить>`

## 2. Цель проекта

Разработать систему автоматизации школьного питания с ролями:
- ученик (`student`),
- повар (`cook`),
- администратор (`admin`).

## 3. Выбранный стек

- Backend: Python 3 + Flask
- База данных: SQLite
- UI: HTML/CSS (Jinja2)
- Контроль версий: Git/GitHub

Выбор обусловлен скоростью разработки, прозрачной архитектурой и воспроизводимым запуском в условиях ограниченного времени.

## 4. Функциональные модули

### 4.1 Авторизация, роли, безопасность

- Публичная регистрация только в роли `student`.
- Публичная форма не содержит выбора роли.
- Администратор управляет ролями и статусом активности пользователей.
- Блокировка пользователя запрещает вход и доступ к защищенным разделам.
- CSRF token в сессии и проверка всех POST-запросов.
- Маршруты чужих ролей отдают `403`.

### 4.2 Ученик

- Просмотр меню и стоимости.
- Оплата (демо): разовый платеж/абонемент.
- Отметка получения питания (с защитой от дубля).
- Профиль питания: аллергии и предпочтения.
- Оставление отзывов о блюдах.

### 4.3 Повар

- Учет выдачи блюд.
- Контроль складских остатков.
- Ручная корректировка остатков (приход/списание).
- Формирование заявок на закупку.

### 4.4 Администратор

- Согласование/отклонение заявок на закупку.
- Сводная статистика по оплатам, получениям, выдачам, закупкам.
- Расчет операционного баланса (`оплаты - затраты`).
- Экспорт отчета в CSV.
- Управление пользователями (`/admin/users`).

## 5. Модель данных

Ключевые таблицы:
- `users` (`role`, `is_active`, `created_at`, профиль питания),
- `menu_items`,
- `payments`,
- `meal_claims`,
- `meal_issues`,
- `inventory`,
- `purchase_requests` (`qty`, `unit_price`, `status`),
- `feedback`.

## 6. Числовая корректность и legacy-политика

- Единая Decimal-валидация для денег/количеств.
- Запрещены: экспоненциальный ввод (`e/E`), `NaN`, `inf`.
- Включены лимиты диапазонов и округление до нужной точности.
- В интерфейсе числа выводятся форматированно (без scientific notation).
- На старте приложения выполняется нормализация legacy-данных:
  - `approved` + `unit_price=0` => `rejected` + системная пометка;
  - `pending` + `unit_price=0` остается `pending` и не влияет на затраты.

## 7. Отчетность

В админ-панели реализованы:
- сводка оплат;
- показатели посещаемости/получений;
- показатели выдачи;
- затраты по одобренным валидным заявкам;
- баланс.

Доступен экспорт `Скачать отчет CSV` с timestamp формирования.

## 8. UI/UX устойчивость

- Таблицы обернуты в скролл-контейнеры.
- Для широких таблиц задана минимальная ширина.
- Длинные значения переносятся, карточки не ломаются.
- На мобильном — устойчивый горизонтальный скролл.
- Кнопки действий админа выровнены вертикальным стеком.

## 9. Покрытие тестами

- Интеграционные тесты: `tests/test_case2_app.py`.
- Проверяются RBAC, CSRF negative path, регистрация только ученика,
  админское назначение ролей, блокировка, numeric-границы,
  legacy policy, корректность отчета и CSV.

Команда запуска:

```bash
python -m unittest discover -s tests -v
```

## 10. Демонстрационный сценарий

Подробный скрипт: `docs/demo_script.md`.

Кратко:
1. Регистрация нового ученика.
2. Действия ученика (оплата, отметка, отзыв).
3. Действия повара (выдача, склад, заявка).
4. Действия админа (согласование, отчет, CSV, управление пользователями).
5. Исключения (дубль отметки, нехватка продукта, блокировка).

## 11. Запуск

```bash
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
python3 app.py
```

- URL: `http://127.0.0.1:5000/login`
- Демо-аккаунты:
  - `admin@predprof.local / admin123`
  - `cook@predprof.local / cook123`
  - `student@predprof.local / student123`

## 12. Ссылки

- Репозиторий: `https://github.com/Pelmeshka126/Predprof-case2-canteen`
- Официальные источники и оргусловия: `docs/official_requirements.md`
- Ссылка на видео: `<добавить после записи>`
