# Полный текст кейса №2 «Управление столовой»

## 1. Титульный блок

- Олимпиада: Московская предпрофессиональная олимпиада школьников 2025/2026
- Профиль: Информационные технологии
- Командный кейс: №2 «Управление столовой»
- Название команды: `<вставить>`
- Участники: `<вставить>`
- Школа: `<вставить>`
- Руководитель: `<вставить>`

## 2. Цель проекта

Создать информационную систему управления школьным питанием с надежным разграничением доступа, корректной отчетностью и устойчивым интерфейсом для трех ролей:
- ученик,
- повар,
- администратор.

## 3. Выбранный стек

- Backend: Python + Flask
- База данных: SQLite
- Интерфейс: Jinja2 templates (server-rendered)
- Контроль версий: Git/GitHub

Причина выбора: быстрый и предсказуемый запуск, низкие инфраструктурные риски и высокая скорость разработки в условиях кейса.

## 4. Реализованный функционал

### 4.1 Безопасность и доступ

- Публичная регистрация только для роли «Ученик».
- Ролевая модель (`student/cook/admin`) с проверками на роуты.
- CSRF-токен в сессии и валидация всех POST-запросов.
- Блокировка пользователя (`is_active`) с запретом входа.
- Единая обработка `403`.

### 4.2 Роль «Ученик»

- Просмотр меню.
- Оплата (разовый платеж/абонемент, демо-режим).
- Отметка получения питания с запретом повторной отметки.
- Профиль питания: аллергии/предпочтения.
- Отзывы о блюдах.

### 4.3 Роль «Повар»

- Учет выдачи блюд.
- Контроль складских остатков.
- Ручная корректировка склада.
- Создание заявок на закупку.
- Обработка исключения «нехватка продукта».

### 4.4 Роль «Администратор»

- Согласование заявок на закупку.
- Управление пользователями (роли, блокировка/разблокировка).
- Сводные метрики за выбранный период.
- Экспорт CSV-отчета.
- Журнал последних админ-действий.

## 5. Сквозной план работы для всех пользователей

### 5.1 Ученик

1. Самостоятельно регистрируется через публичную форму.
2. Получает роль `student` автоматически (без выбора роли в интерфейсе).
3. Входит в систему, просматривает меню и проводит демо-оплату.
4. Отмечает получение питания (повторная отметка блокируется бизнес-правилом).
5. Обновляет профиль питания (аллергии/предпочтения) и оставляет отзывы.

### 5.2 Повар

1. Работает с учетом выдачи блюд и складскими остатками.
2. При нехватке продукта фиксирует инцидент в штатном сценарии исключений.
3. Формирует заявку на закупку с валидными числовыми полями.
4. Видит собственные заявки и их статусы в устойчивой табличной форме.

### 5.3 Администратор

1. Управляет пользователями: смена роли, блокировка/разблокировка.
2. Согласовывает закупочные заявки (approve/reject).
3. Контролирует сводные метрики за период (`date_from/date_to`).
4. Выгружает CSV-отчет в формате, пригодном для Excel.
5. Проверяет журнал `admin_actions` для трассировки критичных действий.

## 6. Модель данных и миграции

Основные таблицы:
- `users`,
- `menu_items`,
- `payments`,
- `meal_claims`,
- `meal_issues`,
- `inventory`,
- `purchase_requests`,
- `feedback`,
- `admin_actions`.

Миграционная устойчивость:
- введена таблица `schema_migrations`;
- шаги миграций выполняются idempotent-подходом;
- runtime-нормализация данных безопасна при повторных запусках.

## 7. Корректность чисел и legacy policy

- Единый `Decimal`-парсинг для денег и количеств.
- Запрет экспоненциального ввода (`e/E`), `NaN`, `inf`.
- Лимиты и округление по бизнес-правилам.
- Отображение чисел без scientific notation.
- Legacy policy:
  - `approved + unit_price=0` -> `rejected` + системная причина;
  - `pending + unit_price=0` не участвует в затратах.

## 8. Отчетность

- Фильтрация периода через `date_from/date_to`.
- Метрики: оплаты, получения, выдача, затраты, баланс.
- CSV-экспорт:
  - UTF-8 BOM,
  - разделитель `;`,
  - timestamp формирования,
  - границы периода.

## 9. UI/UX

- Полная русификация пользовательских интерфейсов.
- Единый layout-каркас без наложения элементов.
- Sticky header в таблицах.
- Горизонтальный/вертикальный скролл больших таблиц.
- Mobile-устойчивость для 360/390/768/1024/1280.

## 10. Тестирование

- `python -m unittest discover -s tests -v`
- 32 интеграционных теста:
  - RBAC/CSRF,
  - регистрация только ученика,
  - блокировка/разблокировка,
  - периодные отчеты,
  - консистентность HTML/CSV,
  - audit log,
  - миграции,
  - env-конфиг.

Визуальные артефакты:
- `output/playwright_v3/*.png` (20 скриншотов на 5 брейкпоинтах).

## 11. Запуск

```bash
./scripts/run_local.sh
```

или:

```bash
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
python3 app.py
```

Адрес: `http://127.0.0.1:5000/login`

## 12. Ссылки

- Репозиторий: `https://github.com/Pelmeshka126/Predprof-case2-canteen`
- Официальные источники: `docs/official_requirements.md`
- Сценарий демо: `docs/demo_script.md`
- Протокол тестирования: `docs/test_protocol.md`
